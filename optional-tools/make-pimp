#!/bin/bash
pimp_2way_nat="/rw/var/run/pimp-2way-nat.tmp"
pimp_snat="/rw/var/run/pimp-snat.tmp"
etchosts="/rw/etc/hosts"

echo -n "Writing $pimp_2way_nat"
echo "#This file was generated by Prometheus-tools/make-pimp" > $pimp_2way_nat
for czfip in `grep [[] $etchosts|cut -f 1`
do
 pubip=`grep "^$czfip	" $etchosts|cut -f 2 -d "["|cut -f 1 -d "]"`
 if ! [ -z $pubip ] 
 then
  echo "$czfip $pubip" >> $pimp_2way_nat
  echo -n .  
 fi
done
echo " done."

echo -n "Writing $pimp_snat"
echo "#This file was generated by Prometheus-tools/make-pimp" > $pimp_snat
for czfip in `grep "(" $etchosts|cut -f 1`
do
 pubip=`grep "^$czfip	" $etchosts|cut -f 2 -d "("|cut -f 1 -d ")"`
 if ! [ -z $pubip ] 
 then
  echo "$czfip $pubip" >> $pimp_snat
  echo -n .  
 fi
done
echo " done."
