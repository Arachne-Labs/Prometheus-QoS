#!/bin/bash
pimp_2way_nat="/dev/shm/pimp-2way-nat.tmp"
pimp_snat="/dev/shm/pimp-snat.tmp"
etchosts="/mnt/mtdblock0/hosts"

echo -n "Writing $pimp_2way_nat"
echo "#This file was generated by Prometheus-tools/make-pimp" > $pimp_2way_nat
for czfip in `grep -v ^# $etchosts|grep [[]|cut -f 1`
do
 pubip=`grep "^$czfip	" $etchosts|cut -f 2 -d "["|cut -f 1 -d "]"`
 if ! [ -z $pubip ] 
 then
  echo "$czfip $pubip" >> $pimp_2way_nat
  echo -n .  
 fi
done
echo " done."

echo -n "Writing $pimp_snat"
echo "#This file was generated by Prometheus-tools/make-pimp" > $pimp_snat
for czfip in `grep -v ^# $etchosts|grep "("|cut -f 1`
do
 pubip=`grep "^$czfip	" $etchosts|cut -f 2 -d "("|cut -f 1 -d ")"`
 if ! [ -z "$pubip" ] 
 then
  echo "$czfip $pubip" >> $pimp_snat
  echo -n .  
 fi
done
echo " done."
